---
title: "Climate data analysis"
author: "Anna Shipunova"
date: "12/5/2020"
output: 
  html_document:
    css: ./storm_data/mystyle.css
---

```{r comment = '', results = 'asis'}

writeLines("
caption {
color: black;
text-align: center;
font-weight: bold;
font-size: x-large;
}
", 
  con = "mystyle.css")
```

```{r setup}
if(!file.exists("./storm_data")){ dir.create("./storm_data") }
knitr::opts_chunk$set(echo = TRUE, cache = FALSE)
knitr::opts_knit$set(root.dir = "./storm_data")
library(readr)
library(dplyr)
library(ggplot2)
library(kableExtra)

```

## Which types of severe weather events have most health and economics impact.

## Synopsis:  
Most fatalities are caused by **heat** and most injures by **tornadoes**.
The most property damage caused by "THUNDERSTORM WIND", "FLASH FLOOD" and      "WATERSPOUT".
The most crop damage caused by "DROUGHT".

## Data Processing  
```{r downloading_data, cache = TRUE}
file_url = "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"

file_destination = "StormData.csv.bz2"
download.file(file_url, destfile = file_destination)

storm_data_csv <- read.csv(file_destination)

```
<!-- 1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?   -->

```{r health}
max_fat = storm_data_csv[storm_data_csv$FATALITIES == max(storm_data_csv$FATALITIES),]

max_inj = storm_data_csv[storm_data_csv$INJURIES == max(storm_data_csv$INJURIES),]
```
```{r health by state}

storm_data_csv %>% 
  group_by(STATE) %>%
  filter(FATALITIES == max(FATALITIES)) %>%
  select(STATE, EVTYPE) %>% 
  unique() %>%
  {.} -> fatal_by_state

storm_data_csv %>% 
  group_by(STATE) %>%
  filter(INJURIES == max(INJURIES)) %>%
  select(STATE, EVTYPE) %>% 
  unique() %>%
  {.} -> inj_by_state

```

<!-- 2. Across the United States, which types of events have the greatest economic consequences? -->

```{r economics}
max_PROPDMG <- filter(storm_data_csv, PROPDMG == max(PROPDMG)) 

max_CROPDMG <- filter(storm_data_csv, CROPDMG == max(CROPDMG)) 

```
```{r economics by state}

storm_data_csv %>% 
  group_by(STATE) %>%
  filter(PROPDMG == max(PROPDMG)) %>%
  select(STATE, EVTYPE) %>% 
  unique() %>%
  {.} -> PROPDMG_by_state

storm_data_csv %>% 
  group_by(STATE) %>%
  filter(CROPDMG == max(CROPDMG)) %>%
  select(STATE, EVTYPE) %>% 
  unique() %>%
  {.} -> CROPDMG_by_state

```

## Results  

### 1. Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?  

Fatality for all the US: `r max_fat$EVTYPE %>% unique()`.  
Injuries for all the US: `r max_inj$EVTYPE %>% unique()`.  

And the same by state:

```{r comment='', results='asis'}

kable_tab = function(x, caption = "") {
  x %>%
  kable(caption = caption) %>%
  kable_classic(full_width = F) %>%
  kable_material("striped") %>%
  kable_styling(fixed_thead = T) %>%
  scroll_box(height = "20em")
}

kable_tab(fatal_by_state[order(fatal_by_state$STATE),], caption = "Fatalities by state")

kable_tab(inj_by_state[order(inj_by_state$STATE),], caption = "Injuries by state")

```

### 2. Across the United States, which types of events have the greatest economic consequences?

Property damage: `r max_PROPDMG$EVTYPE %>% unique()`.  
Crop damage: `r max_CROPDMG$EVTYPE %>% unique()`.  

The same by state:

```{r comment = '', results = 'asis'}
kable_tab(PROPDMG_by_state[order(PROPDMG_by_state$STATE),], 
            caption = "Property damage by state")
 
kable_tab(CROPDMG_by_state[order(CROPDMG_by_state$STATE),], 
            caption = "Crop damage by state")
```

